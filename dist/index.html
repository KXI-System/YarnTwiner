<!doctype html><html><head><meta name="viewport" content="width=device-width,initial-scale=1"><meta charset="utf-8"><title>{{STORY_NAME}} - YarnTwiner</title><style type="text/css">body{margin:auto;max-width:60em;padding:1em}tw-storydata{display:none}.download{float:right}.code{background-color:#d3d3d3;font-family:monospace;margin:0;padding:.5em;white-space:pre-wrap}</style></head><body>{{STORY_DATA}}<div class="content"><h1>{{STORY_NAME}} - YarnTwiner</h1><p>Thanks for using YarnTwiner, below is your story converted into a yarn script. Remember, YarnTwiner can't check if the yarn script is valid or not!</p><hr></div><div class="file"><p><span class="name">{{STORY_NAME}}</span> <button class="download">Download Yarn</button></p><pre class="code"></pre></div><script defer="defer">(()=>{"use strict";window.addEventListener("load",(async function(){const e=document.querySelectorAll("tw-storydata")[0],t=Object.values(document.querySelectorAll("tw-storydata > tw-passagedata"));const n=function(e,t=!1){return e.sort(((e,t)=>e.order-t.order)).reduce(((e,n)=>{if(n.ignore&&!t)return e;if(n.raw)return`${e}${n.content}\n\n`;let r=n.attributes.reduce(((e,t)=>(e.push(`${t.name}: ${t.value}`),e)),[]);return`${e}title: ${n.name}\n${r.join("\n")}\n---\n${n.content}\n===\n\n`}),"")}(t.map((e=>{let t=!1,n=!1,r=!1,a=0,i=e.attributes.name.value;i=i.replace(/[\s\.]/g,"_");let o=e.attributes.tags.value.split(" ").reduce(((e,i)=>{if(!i)return e;if(i.includes("@"))return"@raw"===i&&(t=!0),"@comment"===i&&(r=!0),"@ignore"===i&&(n=!0),i.includes("@order")&&(a=Number(i.split(":")[1])),e;let o="tags",u="";if(i.includes("&")){let e=i.slice(1).replace("-"," ").split(":");o=e[0],u=e[1]}let l=e.findIndex((e=>e.name===o));return-1!==l?e[l].value+=" "+u:e.push({name:o.trim(),value:u.trim()}),e}),[]),u=e.attributes.position.value;o.push({name:"position",value:u});let l=e.innerText;return l=l.replace(/\[\[(.*?)\]\]/g,((e,t)=>`<<jump ${t}>>`)),r&&(l=l.replace(/^/gm,"//")),{name:i,attributes:o,content:l,raw:t,ignore:n,order:a}}))),r=this.document.querySelector(".code");r.innerText=n,this.document.querySelector("button.download").addEventListener("click",(t=>{!function(e,t){let n=new File([e],t,{type:"application/octet-stream"}),r=document.createElement("a");r.href=window.URL.createObjectURL(n),r.download=n.name,document.body.appendChild(r),r.dispatchEvent(new MouseEvent("click",{bubbles:!0,cancelable:!0,view:window})),r.remove(),window.URL.revokeObjectURL(r.href)}(r.innerText,e.attributes.name.value+".yarn")}))}))})();</script></body></html>